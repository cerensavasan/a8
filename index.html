<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="http://underscorejs.org/underscore-min.js"> </script>
<!DOCTYPE><html><head>
  
<style>
  
/* Main Document Styling */ 
html {
  background: #FFE3AA;
  font-family: Sans-Serif;
  line-height: 1.4;
}

h1 {
  margin-top: 30px;
  font-weight: bold;
  color: #AA3939;
  text-align: left;
  clear: both;
}  

h2 {
  font-weight: bold;
  font-size: 1.5em;
  margin: 0 0 0.5em 0;
}  

h3 {
  font-weight: bold;
  margin: 0 0 0.5em 0;
}  

/* Posts */
.posts {
  background-color: #D49A6A;
  border-color: black; 
}

.message {
  clear: left;
  background-color: white;
  border-width: 5px;
  border-color: black;
}

</style>
</head>
<body>
  <h1> BADYAK </h1>
  <form>
    New Post:
    <input type='text' id="messageBox" name="message">
    <button type='button' onclick="sendMessage();" name="sButton">
  </form>
</body>

<script>
//is there already a cookie?
var alreadyExists = false;
if (document.cookie.indexOf("cookieID") >= 0) {
  alreadyExists = true;
}
console.log(alreadyExists);

//random number generator if there is no cookie
if(alreadyExists === false){
  var num = Math.floor(Math.random() * 90000) + 10000;
  var randID = num.toString();
  // sets the cookie cookieID
  document.cookie = "cookieID=" + randID;
  console.log("Cookie set is: " + randID);
}

//open request to send cookie ID and get content
var req = new XMLHttpRequest();
var randID = getCookie("cookieID");
console.log("Sending to server cookie id: " + randID + " of type: " + typeof randID);

req.onreadystatechange = function() {
  handleRes(req);
}

function handleRes(req) {
  if( req.readyState !== XMLHttpRequest.DONE )
    return;

  if(req.status === 200)
    document.querySelector("body").innerHTML += req.responseText;
}

req.open("POST", "/content");
req.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
req.send("theid=" + randID);

//retrieve cookie by name
function getCookie(name) {
  var value = "; " + document.cookie;
  var parts = value.split("; " + name + "=");
  if (parts.length == 2) return parts.pop().split(";").shift();
}

//DEALING WITH MESSAGES
function sendMessage(){
  var elVal = document.getElementById('messageBox').value;
  console.log("Message clicked: " + elVal + " of type: " + typeof elVal);
  var messageRec = elVal;  
  
  var req = new XMLHttpRequest();
  req.onreadystatechange = function() {
    handleRes(req);
  }

  req.open("POST", "/message");
  req.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  req.send("theid=" + randID + "&messager=" + messageRec);

}
</script>
</html>
